---
// P√°gina para que el vendedor solicite delivery
import BaseLayout from '../../../../../layouts/BaseLayout.astro';

export interface Props {
  id: string;
}

const { id } = Astro.params;
---

<BaseLayout title="Solicitar Delivery">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">Solicitar Delivery - Pedido #{id}</h1>
    
    <div class="bg-white rounded-lg shadow-md p-6">
      <form id="delivery-form" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Direcci√≥n de recogida
          </label>
          <input 
            type="text" 
            id="pickup-address" 
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Calle, n√∫mero, comuna"
            required
          />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Direcci√≥n de entrega
          </label>
          <input 
            type="text" 
            id="delivery-address" 
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Calle, n√∫mero, comuna"
            required
          />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Observaciones
          </label>
          <textarea 
            id="notes" 
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            rows="3"
            placeholder="Instrucciones especiales para el repartidor"
          ></textarea>
        </div>
        
        <button 
          type="submit" 
          class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          üöö Solicitar Delivery
        </button>
      </form>
    </div>
  </div>
</BaseLayout>

<script>
document.getElementById('delivery-form')?.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const formData = new FormData(e.target);
  const data = {
    orderId: window.location.pathname.split('/').pop(),
    sellerId: 'test_seller_id',
    pickupAddress: formData.get('pickup-address'),
    deliveryAddress: formData.get('delivery-address'),
    notes: formData.get('notes')
  };
  
  try {
    const response = await fetch('/api/orders/request-delivery', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    
    if (result.success) {
      alert('‚úÖ Delivery solicitado exitosamente. Los repartidores han sido notificados.');
      window.location.href = '/seller/orders';
    } else {
      alert('‚ùå Error: ' + result.error);
    }
  } catch (error) {
    alert('‚ùå Error de conexi√≥n');
  }
});
</script>
